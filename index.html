<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© - Ù†ÙˆØ± Ø§Ù„Ø´Ø§Ù…</title>
</head>
<body style="font-family: 'Cairo', sans-serif; background:#f8f8f8; text-align:center;">

  <h1>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h1>
  <p id="location">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</p>
  <div id="times"></div>

  <!-- ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù† -->
  <audio id="adhan-audio" src="https://download.quranicaudio.com/quran/abdullaah_3awwaad_al-juhaynee/001.mp3"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/adhan/4.4.0/Adhan.js"></script>
  <script>
    // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    if (Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    function showNotification(title, body) {
      if (Notification.permission === "granted") {
        new Notification(title, { body: body, icon: "https://i.ibb.co/tQ6bNQ2/mosque.png" });
      }
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    navigator.geolocation.getCurrentPosition(function(pos) {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      document.getElementById("location").innerText = `Ù…ÙˆÙ‚Ø¹Ùƒ: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;

      const date = new Date();
      const params = adhan.CalculationMethod.MuslimWorldLeague();
      params.adjustments.fajr = 2; // ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„ÙØ¬Ø±
      const prayerTimes = new adhan.PrayerTimes(new adhan.Coordinates(lat, lon), date, params);

      const formatTime = t => t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

      const timesHtml = `
        <p>Ø§Ù„ÙØ¬Ø±: ${formatTime(prayerTimes.fajr)}</p>
        <p>Ø§Ù„Ø¸Ù‡Ø±: ${formatTime(prayerTimes.dhuhr)}</p>
        <p>Ø§Ù„Ø¹ØµØ±: ${formatTime(prayerTimes.asr)}</p>
        <p>Ø§Ù„Ù…ØºØ±Ø¨: ${formatTime(prayerTimes.maghrib)}</p>
        <p>Ø§Ù„Ø¹Ø´Ø§Ø¡: ${formatTime(prayerTimes.isha)}</p>
      `;
      document.getElementById("times").innerHTML = timesHtml;

      // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      function schedulePrayer(prayerName, time) {
        const now = new Date();
        const diff = time - now;

        if (diff > 0) {
          // Ø¥Ø´Ø¹Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ù€10 Ø¯Ù‚Ø§Ø¦Ù‚
          setTimeout(() => {
            showNotification("ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„ØµÙ„Ø§Ø©", `Ø¨Ø§Ù‚ÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø© ${prayerName}`);
          }, diff - 10*60*1000);

          // Ø§Ù„Ø£Ø°Ø§Ù† Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª
          setTimeout(() => {
            showNotification("ğŸ•Œ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©", `Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${prayerName}`);
            document.getElementById("adhan-audio").play();
          }, diff);
        }
      }

      schedulePrayer("Ø§Ù„ÙØ¬Ø±", prayerTimes.fajr);
      schedulePrayer("Ø§Ù„Ø¸Ù‡Ø±", prayerTimes.dhuhr);
      schedulePrayer("Ø§Ù„Ø¹ØµØ±", prayerTimes.asr);
      schedulePrayer("Ø§Ù„Ù…ØºØ±Ø¨", prayerTimes.maghrib);
      schedulePrayer("Ø§Ù„Ø¹Ø´Ø§Ø¡", prayerTimes.isha);

    }, function(err) {
      document.getElementById("location").innerText = "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
    });
  </script>
</body>
</html>