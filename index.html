<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>
  <style>
    body { font-family: "Cairo", sans-serif; text-align: center; background: #f0f0f0; color: #333; }
    h1 { color: #006400; }
    #times { margin-top: 20px; }
    .prayer { padding: 10px; margin: 5px; background: #fff; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
  </style>
</head>
<body>
  <h1>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h1>
  <p id="status">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</p>
  <div id="times"></div>

  <audio id="adhan-audio" src="https://download.tvquran.com/download/adhan/25/Adhan-Makkah.mp3"></audio>

  <script>
    // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    if ("Notification" in window) {
      Notification.requestPermission();
    }

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
    function showNotification(title, body) {
      if (Notification.permission === "granted") {
        new Notification(title, { body });
      }
    }

    // Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ù† API
    function fetchPrayerTimes(lat, lon) {
      const today = new Date();
      const url = `https://api.aladhan.com/v1/timings/${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}?latitude=${lat}&longitude=${lon}&method=2`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          document.getElementById("status").textContent = "âœ… ØªÙ… Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©";
          const timesDiv = document.getElementById("times");
          timesDiv.innerHTML = "";

          const timings = data.data.timings;
          const adhanAudio = document.getElementById("adhan-audio");

          Object.entries(timings).forEach(([name, time]) => {
            if (["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"].includes(name)) {
              const div = document.createElement("div");
              div.className = "prayer";
              div.innerHTML = `<b>${name}:</b> ${time}`;
              timesDiv.appendChild(div);

              // Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
              const [hour, minute] = time.split(":").map(Number);
              const prayerTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hour, minute, 0);

              // Ø¥Ø´Ø¹Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ù€ 10 Ø¯Ù‚Ø§Ø¦Ù‚
              const beforeTime = new Date(prayerTime.getTime() - 10*60000);
              const now = new Date();

              if (beforeTime > now) {
                setTimeout(() => {
                  showNotification("â³ ØªØ°ÙƒÙŠØ±", `Ø¨Ø§Ù‚ÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø© ${name}`);
                }, beforeTime - now);
              }

              // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù† Ø¹Ù†Ø¯ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
              if (prayerTime > now) {
                setTimeout(() => {
                  showNotification("ğŸ•Œ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©", `Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ÙˆÙ‚Øª ${name}`);
                  adhanAudio.play();
                }, prayerTime - now);
              }
            }
          });
        })
        .catch(() => {
          document.getElementById("status").textContent = "âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª";
        });
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          fetchPrayerTimes(pos.coords.latitude, pos.coords.longitude);
        },
        err => {
          document.getElementById("status").textContent = "âš ï¸ Ø±Ø¬Ø§Ø¡Ù‹ ÙØ¹Ù‘Ù„ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª.";
        }
      );
    } else {
      document.getElementById("status").textContent = "âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… GPS";
    }
  </script>
</body>
</html>
